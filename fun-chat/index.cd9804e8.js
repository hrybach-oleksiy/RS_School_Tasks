(()=>{"use strict";var e={385:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},875:(e,t,s)=>{e.exports=s.p+"images/favicon-32x32.ed0873eb.png"}},t={};function s(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,s),n.exports}s.m=e,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var i=o.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=o[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s.b=document.baseURI||self.location.href;var o={};(()=>{s.r(o);var e,t,i,n,a=s(385),r=s.n(a),l=new URL(s(875),s.b);r()(l);class d{constructor({tag:e="div",classNames:t=[],text:s=""},...o){this.children=[];const i=document.createElement(e);i.classList.add(...t),i.textContent=s,this.node=i,o&&this.appendChildren(o)}append(e){this.children.push(e),this.node.append(e.getNode())}appendChildren(e){e.forEach((e=>{this.append(e)}))}getNode(){return this.node}getChildren(){return this.children}setTextContent(e){this.node.textContent=e}setAttribute(e,t){this.node.setAttribute(e,t)}setAttributes(e){Object.keys(e).forEach((t=>{this.node.setAttribute(t,e[t])}))}getAttribute(e){return this.node.getAttribute(e)}removeAttribute(e){this.node.removeAttribute(e)}addClass(e){this.node.classList.add(e)}removeClass(e){this.node.classList.remove(e)}toggleClass(e){this.node.classList.toggle(e)}addListener(e,t,s=!1){this.node.addEventListener(e,t,s)}removeListener(e,t,s=!1){this.node.removeEventListener(e,t,s)}destroyChildren(){this.children.forEach((e=>{e.destroy()})),this.children.length=0}destroy(){this.destroyChildren(),this.node.remove()}}!function(e){e.PLACEHOLDER="placeholder",e.TYPE="type",e.NAME="name",e.ID="id",e.FOR="for",e.REQUIRED="required",e.ACTION="action",e.DISABLED="disabled",e.CHECKED="checked",e.VALUE="value",e.SELECTED="selected"}(e||(e={})),function(e){e.SRC="src",e.ALT="alt"}(t||(t={})),function(e){e.HREF="href",e.TARGET="target"}(i||(i={})),function(e){e.LOGIN="USER_LOGIN",e.LOGOUT="USER_LOGOUT",e.ACTIVE="USER_ACTIVE",e.INACTIVE="USER_INACTIVE",e.ERROR="ERROR"}(n||(n={}));class h extends d{constructor({classNames:t,id:s,type:o="text",name:i,placeholder:n,required:a,checked:r,onChange:l}){super({tag:"input",classNames:t}),this.setAttribute(e.ID,s),this.setAttribute(e.TYPE,o),this.setAttribute(e.NAME,i),n&&this.setAttribute(e.PLACEHOLDER,n),r&&this.setAttribute(e.CHECKED,r),a&&this.setAttribute(e.REQUIRED,a),l&&(this.onChange=l,this.addListener("input",this.onChange))}destroy(){this.onChange&&(this.removeListener("input",this.onChange),super.destroy())}}class c extends d{constructor({classNames:e,text:t,onClick:s}){super({tag:"button",classNames:e,text:t}),s&&(this.onClick=s,this.addListener("click",this.onClick))}destroy(){this.onClick&&(this.removeListener("click",this.onClick),super.destroy())}}const u=(e,...t)=>new d({tag:"div",classNames:e},...t),g=(e,t)=>new d({tag:"h1",classNames:e,text:t}),p=(e,t,s,o,i,n,a)=>new h({classNames:e,id:t,name:s,type:o,placeholder:i,required:n,onChange:a}),m=(e,t)=>new d({tag:"label",classNames:e,text:t}),w=(e,t,s)=>new c({classNames:e,text:t,onClick:s}),b=e=>new d({tag:"img",classNames:e}),L=e=>new d({tag:"a",classNames:e});class v extends d{constructor(e){super({tag:"header",classNames:["Header-module_header_uNX8Ji"]},new d({tag:"p",classNames:["Header-module_header-title_Ryd7lg"],text:"Fun Chat"})),this.logoutButton=w(["btn","header-btn"],"Log Out"),this.handleLogoutButtonClick=()=>{this.logoutButton.addClass("hidden")},this.handleUserLogout=()=>{this.logoutCallback()},this.logoutCallback=e,this.logoutButton.removeClass("hidden"),this.setContent()}setContent(){const e=u(["Header-module_wrapper_xhbvNE"]);this.logoutButton.addListener("click",this.handleLogoutButtonClick),this.logoutButton.addListener("click",this.handleUserLogout),"#chat"!==window.location.hash&&this.logoutButton.addClass("hidden"),e.appendChildren([this.logoutButton]),this.append(e)}}class E extends d{constructor(){super({tag:"main",classNames:["Main-module_main_d2LaAM","container"]})}}const y=s.p+"images/school-logo.ad178c0d.svg",C=s.p+"images/github-logo.1bc6258a.svg",A="Footer-module_link_IhM0Td",_="Footer-module_img_BHwJLh";class f extends d{constructor(){super({tag:"footer",classNames:["Footer-module_footer_lJrnFv"]}),this.setBlock()}setBlock(){const e=u(["Footer-module_copyright_U8o4L2"]),s=L([A]),o=L([A]),n=new d({tag:"span",classNames:["copy"],text:"Â© 2024, by Hrybach Oleksiy"}),a=b([_]),r=b([_]);s.setAttribute(i.HREF,"https://github.com/hrybach-oleksiy"),s.setAttribute(i.TARGET,"_blank"),o.setAttribute(i.HREF,"https://rs.school/js/"),o.setAttribute(i.TARGET,"_blank"),a.setAttribute(t.SRC,C),a.setAttribute(t.ALT,"GitHub Logo"),r.setAttribute(t.SRC,y),r.setAttribute(t.ALT,"RS School Logo"),s.append(a),o.append(r),e.appendChildren([s,o,n]),this.append(e)}}class N{constructor(e){this.locationHandler=()=>{let e=window.location.hash.replace("#","");0===e.length&&(e="/");const t=this.routes.find((t=>t.path===e));void 0!==t?t.render():(console.log("There are now such page"),this.routes[this.routes.length-1].render())},this.routes=e,window.addEventListener("hashchange",this.locationHandler),this.locationHandler()}}function U(e){if(null==e)throw new Error(`${e} is not defined`)}const V="Modal-module_hidden_O_l9Hl";class R extends d{constructor(e){super({tag:"div",classNames:["Modal-module_modal_FjwuUY",V]}),this.contentElement=new d({tag:"div",classNames:["Modal-module_modal__content_IVvoQZ"]}),this.isOpen=!1,this.open=()=>{this.isOpen||(this.removeClass(V),this.isOpen=!0)},this.close=()=>{this.isOpen&&(this.addClass(V),this.isOpen=!1,this.destroy())},this.content=e}render(){const e=document.querySelector("main");U(e),this.contentElement.append(this.content),this.append(this.contentElement),e.append(this.getNode())}addCloseBtn(e){const t=w(["btn","close"],e);t.addListener("click",this.close),this.contentElement.append(t)}}class I{constructor(e,t,s,o){this.handleResponse=e=>{let t;switch(e.type){case n.LOGIN:t=e.payload,this.userLoginResponse(t);break;case n.LOGOUT:t=e.payload,this.userLogoutResponse(t);break;case n.ACTIVE:t=e.payload,this.getActiveUsersResponse(t);break;case n.INACTIVE:t=e.payload,this.getInActiveUsersResponse(t);break;case n.ERROR:t=e.payload,I.handleError(t);break;default:console.error("Unknown payload type:",e.payload)}},this.userLoginResponse=e=>{const t=document.querySelector(".header-btn");console.log(`User ${e.user.login} logged in successfully`),window.location.hash="chat",this.model.getActiveUser(),this.model.getInActiveUser(),t?.classList.remove("hidden")},this.userLogoutResponse=e=>{console.log(`User ${e.user.login} logged out successfully`),window.location.hash="login",console.log(this)},this.getActiveUsersResponse=e=>{this.chatView.renderUsers(e.users)},this.getInActiveUsersResponse=e=>{this.chatView.renderUsers(e.users)},this.model=e,this.authView=t,this.chatView=s,this.router=o}}I.handleError=e=>{const t=new d({tag:"div",classNames:["modal-error"],text:e.error}),s=new R(t);s.render(),s.addCloseBtn("Close"),s.open()};const S=I;class O{constructor(e){this.loginUser=(e,t)=>{const s={id:null,type:n.LOGIN,payload:{user:{login:e,password:t}}};this.ws.send(JSON.stringify(s))},this.logoutUser=(e,t)=>{const s={id:null,type:n.LOGOUT,payload:{user:{login:e,password:t}}};this.ws.send(JSON.stringify(s))},this.getActiveUser=()=>{const e={id:null,type:n.ACTIVE,payload:null};this.ws.send(JSON.stringify(e))},this.getInActiveUser=()=>{const e={id:null,type:n.INACTIVE,payload:null};this.ws.send(JSON.stringify(e))},this.ws=e}}const k="LoginView-module_text-field_x742KT",x="LoginView-module_label_rjuLej",T="LoginView-module_input_vFuc2V",D="LoginView-module_valid_VS22J5",M="LoginView-module_invalid_vUwoZg",F="LoginView-module_hidden__AQi6V",B="LoginView-module_name-error_hU3Fht",P="LoginView-module_password-error_z_Ewun";class H extends d{constructor(t,s){super({tag:"form",classNames:["LoginView-module_form_UVico1","form"]}),this.loginButton=w(["button","btn","login-btn"],"Login"),this.isNameValid=!1,this.isPasswordValid=!1,this.handleKeyDown=e=>{"Enter"===e.key&&this.isNameValid&&this.isPasswordValid&&(e.preventDefault(),this.saveUserData())},this.loginCallback=t,this.setUserDataCallback=s,this.setAttribute(e.ACTION,""),this.addListener("submit",(e=>{e.preventDefault(),this.saveUserData()})),document.addEventListener("keydown",this.handleKeyDown)}setForm(){const t=g(["form__title","title"],"Login"),s=m([x],"Name"),o=m([x],"Password"),i=u([B,F]),n=u([P,F]);this.nameInput=p([T,"name-input"],"name","name","text","Enter your Name","true",(e=>{this.validateName(e)})),this.passwordInput=p([T],"password","password","password","Enter your Password","true",(e=>{this.validatePassword(e)})),s.setAttribute(e.FOR,"name"),o.setAttribute(e.FOR,"password");const a=u([k],s,this.nameInput,i),r=u([k],o,this.passwordInput,n);this.loginButton.setAttribute(e.DISABLED,"true"),this.appendChildren([t,a,r,this.loginButton])}toggleLoginButtonState(){this.isNameValid&&this.isPasswordValid?this.loginButton.removeAttribute(e.DISABLED):this.loginButton.setAttribute(e.DISABLED,"true")}toggleInputState(e,t,s){t.classList.toggle(D,e),t.classList.toggle(M,!e),"name"===s&&(this.isNameValid=e),"password"===s&&(this.isPasswordValid=e),0===t.value.length&&(t.classList.remove(D),t.classList.remove(M),"name"===s&&(this.isNameValid=!1),"password"===s&&(this.isPasswordValid=!1)),this.toggleLoginButtonState()}validateName(e){const t=e.target,s=H.validateTextField(t);this.toggleInputState(s,t,t.name)}validatePassword(e){const t=e.target,s=H.validatePasswordField(t);this.toggleInputState(s,t,t.name)}static validateTextField(e){const t=e.value,s=document.querySelector(`.${B}`);if(U(s),""===t.trim())return H.hideErrorMessage(s),!1;if(!/^[A-Za-z-]+$/.test(t))return H.showErrorMessage(s,'Field only accept English alphabet letters and the hyphen (" - ") symbol'),!1;if(!/^[A-Z]/.test(t))return H.showErrorMessage(s,"First letter of the name must be in uppercase"),!1;if(t.length<3){const e="Minimum length of the name is 3 characters";return H.showErrorMessage(s,e),!1}return H.hideErrorMessage(s),!0}static validatePasswordField(e){const t=e.value,s=document.querySelector(`.${P}`);return U(s),""===t.trim()?(H.hideErrorMessage(s),!1):/^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()-_+=])[A-Za-z\d!@#$%^&*()-_+=]{8,}$/.test(t)?(H.hideErrorMessage(s),!0):(H.showErrorMessage(s,"Password must be at least 8 characters long and contain at least one uppercase letter and one number"),!1)}static showErrorMessage(e,t){const s=e;e.classList.remove(F),s.textContent=t}static hideErrorMessage(e){const t=e;e.classList.add(F),t.textContent=""}saveUserData(){const e=this.nameInput?.getNode(),t=this.passwordInput?.getNode();U(e),U(t);const s={login:e.value,password:t.value},o=JSON.stringify(s);sessionStorage.setItem("userData",o),this.loginCallback(s.login,s.password),this.setUserDataCallback(s)}}class G extends d{constructor(){super({tag:"div",classNames:["ChatView-module_chat_xTGoTU"]}),this.userListWrapperElem=u(["ChatView-module_user-list-wrapper_MQSN06"]),this.userList=new d({tag:"ul",classNames:["user-list"]}),this.renderUsers=e=>{e.forEach((e=>{const t=(s=e.login,new d({tag:"li",classNames:["list-item"],text:s}));var s;this.userList.append(t)}))}}setPage(){const e=u(["ChatView-module_message-field-wrapper_MNUO3I"]);this.userListWrapperElem.append(this.userList),this.appendChildren([this.userListWrapperElem,e])}}class $ extends d{constructor(){super({tag:"div",classNames:["NotFound-module_not-found_RbUno8"]})}setPage(){const e=g(["title"],"Page not found"),t=w(["btn"],"Back to the Main page");t.addListener("click",(()=>{window.location.hash=""})),this.appendChildren([e,t])}}class j{constructor(){this.root=u(["app"]),this.main=new E,this.userData=null,this.handleUserLogout=()=>{if(this.userData){const{login:e,password:t}=this.userData;this.userModel.logoutUser(e,t),sessionStorage.removeItem("userData")}},this.setUserData=e=>{this.userData=e},document.body.append(this.root.getNode()),document.body.setAttribute("data-theme","light"),this.ws=new WebSocket("ws://127.0.0.1:4000"),this.userModel=new O(this.ws),this.authView=new H(this.userModel.loginUser,this.setUserData),this.chatView=new G,this.notFoundView=new $;const e=this.createRoutes();this.router=new N(e),this.authController=new S(this.userModel,this.authView,this.chatView,this.router),this.ws.onmessage=e=>{const t=JSON.parse(e.data);console.log(t),this.authController.handleResponse(t)},this.userData=j.getUserData()}createLayout(){const e=new v(this.handleUserLogout),t=new f;this.root.appendChildren([e,this.main,t])}createRoutes(){return[{path:"/",render:()=>{this.main.destroyChildren(),this.authView.setForm(),this.main.append(this.authView)}},{path:"chat",render:()=>{this.main.destroyChildren(),this.chatView.setPage(),this.main.append(this.chatView),this.userModel.getActiveUser(),this.userModel.getInActiveUser()}},{path:"login",render:()=>{this.main.destroyChildren(),this.authView.setForm(),this.main.append(this.authView)}},{path:"404",render:()=>{this.main.destroyChildren(),this.notFoundView.setPage(),this.main.append(this.notFoundView)}}]}}j.getUserData=()=>{const e=sessionStorage.getItem("userData");if(e){const t=JSON.parse(e);return console.log(t),t}return null},(new j).createLayout()})()})();