(()=>{"use strict";var e={385:e=>{e.exports=function(e,s){return s||(s={}),e?(e=String(e.__esModule?e.default:e),s.hash&&(e+=s.hash),s.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},875:(e,s,t)=>{e.exports=t.p+"images/favicon-32x32.ed0873eb.png"}},s={};function t(a){var i=s[a];if(void 0!==i)return i.exports;var n=s[a]={exports:{}};return e[a](n,n.exports,t),n.exports}t.m=e,t.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},t.d=(e,s)=>{for(var a in s)t.o(s,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var a=s.getElementsByTagName("script");if(a.length)for(var i=a.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=a[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href;var a={};(()=>{t.r(a);var e,s,i,n,o,r=t(385),l=t.n(r),h=new URL(t(875),t.b);l()(h);class d{constructor({tag:e="div",classNames:s=[],text:t=""},...a){this.children=[];const i=document.createElement(e);i.classList.add(...s),i.textContent=t,this.node=i,a&&this.appendChildren(a)}append(e){this.children.push(e),this.node.append(e.getNode())}appendChildren(e){e.forEach((e=>{this.append(e)}))}getNode(){return this.node}getChildren(){return this.children}setTextContent(e){this.node.textContent=e}setAttribute(e,s){this.node.setAttribute(e,s)}setAttributes(e){Object.keys(e).forEach((s=>{this.node.setAttribute(s,e[s])}))}getAttribute(e){return this.node.getAttribute(e)}removeAttribute(e){this.node.removeAttribute(e)}addClass(e){this.node.classList.add(e)}removeClass(e){this.node.classList.remove(e)}toggleClass(e){this.node.classList.toggle(e)}addListener(e,s,t=!1){this.node.addEventListener(e,s,t)}removeListener(e,s,t=!1){this.node.removeEventListener(e,s,t)}destroyChildren(){this.children.forEach((e=>{e.destroy()})),this.children.length=0}destroy(){this.destroyChildren(),this.node.remove()}}!function(e){e.PLACEHOLDER="placeholder",e.TYPE="type",e.NAME="name",e.ID="id",e.FOR="for",e.REQUIRED="required",e.ACTION="action",e.DISABLED="disabled",e.CHECKED="checked",e.VALUE="value",e.SELECTED="selected"}(e||(e={})),function(e){e.SRC="src",e.ALT="alt"}(s||(s={})),function(e){e.HREF="href",e.TARGET="target"}(i||(i={})),function(e){e.LOGIN="USER_LOGIN",e.LOGOUT="USER_LOGOUT",e.ACTIVE="USER_ACTIVE",e.INACTIVE="USER_INACTIVE",e.EXTERNAL_LOGIN="USER_EXTERNAL_LOGIN",e.EXTERNAL_LOGOUT="USER_EXTERNAL_LOGOUT",e.ERROR="ERROR"}(n||(n={})),function(e){e.SEND="MSG_SEND",e.FROM="MSG_FROM_USER",e.READ="MSG_READ",e.DELETE="MSG_DELETE",e.EDIT="MSG_EDIT",e.DELIVER="MSG_DELIVER"}(o||(o={}));class c extends d{constructor({classNames:s,id:t,type:a="text",name:i,placeholder:n,required:o,checked:r,onChange:l}){super({tag:"input",classNames:s}),this.setAttribute(e.ID,t),this.setAttribute(e.TYPE,a),this.setAttribute(e.NAME,i),n&&this.setAttribute(e.PLACEHOLDER,n),r&&this.setAttribute(e.CHECKED,r),o&&this.setAttribute(e.REQUIRED,o),l&&(this.onChange=l,this.addListener("input",this.onChange))}destroy(){this.onChange&&(this.removeListener("input",this.onChange),super.destroy())}}class g extends d{constructor({classNames:e,text:s,onClick:t}){super({tag:"button",classNames:e,text:s}),t&&(this.onClick=t,this.addListener("click",this.onClick))}destroy(){this.onClick&&(this.removeListener("click",this.onClick),super.destroy())}}const u=(e,...s)=>new d({tag:"div",classNames:e},...s),m=(e,s)=>new d({tag:"p",classNames:e,text:s}),p=(e,s)=>new d({tag:"h1",classNames:e,text:s}),E=(e,s)=>new d({tag:"span",classNames:e,text:s}),w=(e,s,t,a,i,n,o)=>new c({classNames:e,id:s,name:t,type:a,placeholder:i,required:n,onChange:o}),b=(e,s)=>new d({tag:"label",classNames:e,text:s}),v=(e,s,t)=>new g({classNames:e,text:s,onClick:t}),C=e=>new d({tag:"img",classNames:e}),L=e=>new d({tag:"ul",classNames:e}),_=(e,s)=>new d({tag:"li",classNames:e,text:s}),M=e=>new d({tag:"a",classNames:e});class y extends d{constructor(e,s){super({tag:"header",classNames:["Header-module_header_uNX8Ji"]},m(["Header-module_header-title_Ryd7lg"],"Fun Chat")),this.buttonsWrapper=u(["Header-module_wrapper_xhbvNE","header-block"]),this.logoutButton=v(["btn","header-btn"],"Log Out"),this.aboutButton=v(["btn"],"About"),this.userNameElem=new d({tag:"h2",classNames:["user-name"],text:""}),this.addHeaderBlocks=e=>{this.userNameElem.setTextContent(`User: ${e}`),this.buttonsWrapper.appendChildren([this.logoutButton,this.userNameElem])},this.handleUserLogout=()=>{this.userNameElem.destroy(),this.logoutButton.getNode().remove(),this.logoutCallback(),sessionStorage.setItem("currentLocation","login"),this.eventManager.setUseLoginSubmitEventCallback(!0)},this.logoutCallback=e,this.eventManager=s,this.setContent()}setContent(){this.logoutButton.addListener("click",this.handleUserLogout),this.aboutButton.addListener("click",y.handleAboutButtonClick),this.buttonsWrapper.append(this.aboutButton),this.append(this.buttonsWrapper)}}y.handleAboutButtonClick=()=>{window.location.hash="about"};const A=y;class S extends d{constructor(){super({tag:"main",classNames:["Main-module_main_d2LaAM","container"]})}}const f=t.p+"images/school-logo.ad178c0d.svg",k=t.p+"images/github-logo.1bc6258a.svg",D="Footer-module_link_IhM0Td",N="Footer-module_img_BHwJLh";class U extends d{constructor(){super({tag:"footer",classNames:["Footer-module_footer_lJrnFv"]}),this.setBlock()}setBlock(){const e=u(["Footer-module_copyright_U8o4L2"]),t=M([D]),a=M([D]),n=E(["Footer-module_copy_JDdXTZ"],"Â© 2024, by Hrybach Oleksiy"),o=C([N]),r=C([N]);t.setAttribute(i.HREF,"https://github.com/hrybach-oleksiy"),t.setAttribute(i.TARGET,"_blank"),a.setAttribute(i.HREF,"https://rs.school/js/"),a.setAttribute(i.TARGET,"_blank"),o.setAttribute(s.SRC,k),o.setAttribute(s.ALT,"GitHub Logo"),r.setAttribute(s.SRC,f),r.setAttribute(s.ALT,"RS School Logo"),t.append(o),a.append(r),e.appendChildren([t,a,n]),this.append(e)}}function R(e){if(null==e)throw new Error(`${e} is not defined`)}const V="Modal-module_hidden_O_l9Hl";class x extends d{constructor(e){super({tag:"div",classNames:["Modal-module_modal_FjwuUY",V,"modal-js"]}),this.contentElement=new d({tag:"div",classNames:["Modal-module_modal__content_IVvoQZ"]}),this.isOpen=!1,this.open=()=>{this.isOpen||(this.removeClass(V),this.isOpen=!0)},this.close=()=>{this.isOpen&&(this.addClass(V),this.isOpen=!1,this.destroy())},this.content=e}render(){const e=document.querySelector("main");R(e),this.contentElement.append(this.content),this.append(this.contentElement),e.append(this.getNode())}addCloseBtn(e){const s=v(["btn","close"],e);s.addListener("click",this.close),this.contentElement.append(s)}}class I extends d{constructor(e){super({tag:"div",classNames:["AboutView-module_about_DjH5W7"]}),this.handleCloseButton=()=>{const e=sessionStorage.getItem("currentLocation");console.log(e),R(e),window.location.hash=e,"chat"===e&&this.updateUserList()},this.updateUserList=e}setPage(){this.getNode().innerHTML="";const e=m(["AboutView-module_text_G7U1qM"],"What could be better than chatting with your friends using a chat app? The app developed using WebSockets, and vanilla JavaScript (TypeScript)"),s=v(["btn"],"Back"),t=M(["AboutView-module_link_tCNUSK"]);t.setTextContent("Created by Oleksiy Hrybach"),t.setAttribute(i.HREF,"https://github.com/hrybach-oleksiy"),t.setAttribute(i.TARGET,"_blank"),s.addListener("click",this.handleCloseButton),this.appendChildren([e,t,s])}}class T{constructor(e){this.locationHandler=()=>{const e=T.getUserData();let s=window.location.hash.replace("#","");"login"===s&&e?s="chat":"chat"!==s||e?0===s.length&&(s=e?"chat":"login"):s="login",window.location.hash=s;const t=this.routes.find((e=>e.path===s));void 0!==t?t.render():(console.log("There are now such page"),this.routes[this.routes.length-1].render())},this.routes=e,window.addEventListener("hashchange",this.locationHandler),this.locationHandler()}}T.getUserData=()=>{const e=sessionStorage.getItem("userData");return e?JSON.parse(e):null};const O=T;class F{constructor(){this.loginSubmitEventCallback=null,this.sendMessageEventCallback=null,this.useLoginSubmitEventCallback=!0,this.handleKeyDown=e=>{"Enter"===e.key&&(e.preventDefault(),this.useLoginSubmitEventCallback&&this.loginSubmitEventCallback&&"#login"===window.location.hash&&this.loginSubmitEventCallback(),!this.useLoginSubmitEventCallback&&this.sendMessageEventCallback&&this.sendMessageEventCallback(e))},this.setUseLoginSubmitEventCallback=e=>{this.useLoginSubmitEventCallback=e},this.setLoginSubmitEventCallback=e=>{this.loginSubmitEventCallback=e},this.setSendMessageEventCallback=e=>{this.sendMessageEventCallback=e},document.addEventListener("keydown",this.handleKeyDown)}}const B="MessageBlock-module_align-right_KLaa33";class H extends d{constructor(e,s){super({tag:"div",classNames:["MessageBlock-module_message-block_M4wA2D","message-block-js"]}),this.messageProps=e,this.author=s,R(this.messageProps.id),this.setAttribute("data-message",this.messageProps.id),this.setPage(this.messageProps)}setPage(e){const s=u(["MessageBlock-module_message-header_VdTYZ_"]),t=E(["author-name"],this.author);R(e.datetime);const a=E(["date"],function(e){const s=new Date(e);return`${`0${s.getDate()}`.slice(-2)}.${`0${s.getMonth()+1}`.slice(-2)}.${s.getFullYear()}, ${`0${s.getHours()}`.slice(-2)}:${`0${s.getMinutes()}`.slice(-2)}:${`0${s.getSeconds()}`.slice(-2)}`}(e.datetime));s.appendChildren([t,a]);const i=u(["MessageBlock-module_message-body_R_oOlS"]),n=m(["MessageBlock-module_text_dLBPdf"],e.text);i.append(n);const o=u(["MessageBlock-module_message-footer_T1scfa"]),r=e.status?.isDelivered?"delivered":"not delivered",l=e.status?.isEdited?"edited":"",h=e.status?.isReaded?"read":"not read",d=E(["message-status"],r),c=E(["message-edited"],l),g=E(["message-read"],h);o.append(c),this.author!==e.from&&o.appendChildren([d,g]),this.appendChildren([s,i,o])}}const P="ChatView-module_message-counter_MkyN9x",W="ContextMenu-module_menu-item_nZVOB9";class j extends d{constructor(e,s){super({tag:"div",classNames:["ContextMenu-module_context-menu_SY78La","context-menu-js"]}),this.remove=()=>{this.destroy()},this.show=e=>{e.append(this)},document.addEventListener("click",(e=>{this.getNode().contains(e.target)||this.remove()})),this.setBlock(),this.onDelete=e,this.onEdit=s}setBlock(){const e=L(["ContextMenu-module_menu-list_Ldw7U5"]),s=_([W],"Delete"),t=_([W],"Edit");s.addListener("click",(e=>{const s=e.target.closest(".message-block-js").dataset.message;R(s),this.onDelete(s),this.remove()})),t.addListener("click",(e=>{const s=e.target.closest(".message-block-js"),t=s.querySelector(".text")?.textContent,a=s.dataset.message;R(a),R(t),this.onEdit(a,t),this.remove()})),e.appendChildren([s,t]),this.append(e)}}class G extends d{constructor(s,t,a,i,n,o){super({tag:"div",classNames:["ChatView-module_chat_xTGoTU"]}),this.messageFieldWrapperElem=u(["ChatView-module_message-field-wrapper_MNUO3I"]),this.userListWrapperElem=u(["ChatView-module_user-list-wrapper_MQSN06"]),this.activeUserList=L(["ChatView-module_active-user-list_VBnEwC"]),this.inActiveUserList=L(["ChatView-module_inactive-user-list_kaPj_V"]),this.messageInputElem=w(["ChatView-module_message-input_Sl1WiT","message-input-js"],"message","message","text","Type the Message"),this.searchInput=w(["ChatView-module_search-input_wpW4Gj"],"search-input","search-input","text","Search User"),this.messageForm=new d({tag:"form",classNames:["ChatView-module_message-form_RqXMAl"]}),this.messagesWrapper=u(["ChatView-module_message-wrapper_aobeoF"]),this.messageFieldPlaceHolder=m(["ChatView-module_first-message-placeholder_Cx9tUb"],"Enter your first message"),this.currentUser="",this.messageData={message:{id:"",to:"",text:""}},this.messageBtnElem=v(["btn","ChatView-module_message-btn_y9H8w9"],"Send"),this.unreadCounts=[],this.separatorElement=E(["ChatView-module_separator__FbRoe"],"New Messages"),this.setMessageField=(e,s)=>{const t=u(["ChatView-module_message-field-header_PR4jy0"]),a=E(["ChatView-module_user-name_ZAA4b2"],e),i=E(["ChatView-module_user-status_A7D55W",s?"ChatView-module_user-online_vt_wp5":"ChatView-module_user-offline_he0MHl"],s?"online":"offline");this.messageForm.addListener("submit",this.sendMessageHandler),this.messagesWrapper.addListener("click",this.readMessageHandler),t.appendChildren([a,i]),this.messagesWrapper.append(this.messageFieldPlaceHolder),this.messageForm.appendChildren([this.messageInputElem,this.messageBtnElem]),this.messageFieldWrapperElem.appendChildren([t,this.messagesWrapper,this.messageForm])},this.addMessageField=(e,s)=>{this.messageFieldWrapperElem.destroyChildren(),this.setMessageField(e,s)},this.setMessageData=()=>{const e=this.messageInputElem.getNode().value;this.messageData.message.text=e},this.renderActiveUsers=e=>{this.currentUser=G.getUserData()?.login,this.activeUserList.getNode().innerHTML="",e.filter((e=>e.login!==this.currentUser)).forEach((e=>{const s=_(["list-item","user"],e.login);s.addClass("ChatView-module_active-user_lKNR4_"),s.addListener("click",(()=>{R(e.isLogined),this.addMessageField(e.login,e.isLogined),this.messageData.message.to=e.login,this.fetchMessagesCallback(e.login)})),this.fetchMessagesCallback(e.login),setTimeout((()=>{this.unreadCounts.forEach((t=>{if(t.author===e.login){const e=E([P],String(t.unreadMessages));s.append(e)}}))}),500),this.activeUserList.append(s)}))},this.renderInActiveUsers=e=>{this.currentUser=G.getUserData()?.login,this.inActiveUserList.getNode().innerHTML="",e.filter((e=>e.login!==this.currentUser)).forEach((e=>{const s=_(["list-item","user"],e.login);s.addClass("ChatView-module_inactive-user_s1yB5s"),s.addListener("click",(()=>{R(e.isLogined),this.addMessageField(e.login,e.isLogined),this.messageData.message.to=e.login,this.fetchMessagesCallback(e.login)})),this.fetchMessagesCallback(e.login),setTimeout((()=>{this.unreadCounts.forEach((t=>{if(t.author===e.login){const e=E([P],String(t.unreadMessages));s.append(e)}}))}),500),this.inActiveUserList.append(s)}))},this.renderMessage=e=>{const s=e.to,t=s===this.currentUser?e.from:"You";R(t);const a=new H(e,t);s===this.currentUser?(a.addClass(B),this.messagesWrapper.append(this.separatorElement)):(a.addListener("contextmenu",(e=>{e.preventDefault(),document.querySelectorAll(".context-menu-js").forEach((e=>{e.remove()})),new j(this.removeMessageCallback,this.editMessage).show(a)})),a.setAttribute("data-author","you")),this.messageFieldPlaceHolder.destroy(),this.messagesWrapper.append(a),this.messagesWrapper.getNode().scrollTo({top:this.messagesWrapper.getNode().scrollHeight,behavior:"smooth"})},this.renderAllMessages=e=>{e.length&&this.messagesWrapper.destroyChildren();const s=e.findIndex((e=>(R(e.status),!e.status.isReaded)));e.forEach(((e,t)=>{const a=e.to,i=a===this.currentUser?e.from:"You";R(i);const n=new H(e,i);a===this.currentUser&&(n.addClass(B),e.status?.isReaded||t!==s||this.messagesWrapper.append(this.separatorElement)),a!==this.currentUser&&(n.addListener("contextmenu",(e=>{e.preventDefault(),document.querySelectorAll(".context-menu-js").forEach((e=>{e.remove()})),new j(this.removeMessageCallback,this.editMessage).show(n)})),n.setAttribute("data-author","you")),this.messagesWrapper.append(n)}));const t=this.separatorElement.getNode().offsetTop;this.messagesWrapper.getNode().scrollTo({top:t||this.messagesWrapper.getNode().scrollHeight,behavior:"smooth"}),setTimeout((()=>{this.messagesWrapper.addListener("scroll",this.readMessageHandler),this.messagesWrapper.addListener("wheel",this.readMessageHandler)}),500)},this.addUnreadMessages=e=>{e.forEach((e=>{const{from:s,status:t}=e,a=s,i=t?.isReaded;if(R(a),this.unreadCounts.some((e=>e.author===a))||this.unreadCounts.push({author:a,unreadMessages:0}),!i){const e=this.unreadCounts.findIndex((e=>e.author===a));-1!==e&&(this.unreadCounts[e].unreadMessages+=1)}}))},this.editMessage=(e,s)=>{const t=document.querySelectorAll(".message-block-js"),a=document.querySelector(".message-input-js");this.messageData.message.id=e,this.messageData.message.text=s,R(a),t.forEach((t=>{t.dataset.message===e&&(a.value=s,this.messageBtnElem.setTextContent("Edit"))})),this.messageForm.removeListener("submit",this.sendMessageHandler),this.messageForm.addListener("submit",this.editMessageHandler)},this.sendMessageHandler=s=>{s.preventDefault(),this.setMessageData();const t=this.messageData.message.to,a=this.messageData.message.text;this.sendMessageCallback(t,a),this.messageForm.getNode().reset(),this.messageBtnElem.setAttribute(e.DISABLED,"true"),this.readMessageHandler(),this.eventManager.setUseLoginSubmitEventCallback(!0)},this.handleKeyDown=e=>{this.sendMessageHandler(e)},this.editMessageHandler=e=>{e.preventDefault(),this.setMessageData();const s=this.messageData.message.id,t=this.messageData.message.text;this.changeMessageCallback(s,t),this.messageForm.getNode().reset(),this.messageBtnElem.setTextContent("Send"),this.messageForm.removeListener("submit",this.editMessageHandler),this.messageForm.addListener("submit",this.sendMessageHandler)},this.readMessageHandler=()=>{document.querySelectorAll(".message-block-js").forEach((e=>{const s=e.dataset.message,{author:t}=e.dataset;R(s),t||this.readMessageCallback(s)})),this.separatorElement.destroy()},this.handleMessageInput=s=>{s.target.value.trim()?(this.messageBtnElem.removeAttribute(e.DISABLED),this.eventManager.setUseLoginSubmitEventCallback(!1)):this.messageBtnElem.setAttribute(e.DISABLED,"true")},this.changeDeliveryStatus=e=>{const s=document.querySelectorAll(".message-block-js");this.messageData.message.id=e,s.forEach((s=>{if(s.dataset.message===e){const e=s.querySelector(".message-status");R(e),e.textContent="delivered"}}))},this.sendMessageCallback=s,this.fetchMessagesCallback=t,this.removeMessageCallback=a,this.changeMessageCallback=i,this.readMessageCallback=n,this.eventManager=o,this.messageBtnElem.setAttribute(e.DISABLED,"true"),this.eventManager.setSendMessageEventCallback(this.handleKeyDown)}setPage(){const e=m(["ChatView-module_message-field-placeholder_XTJLV4"],"Select the user to send a message");this.searchInput.addListener("input",(e=>{G.searchUsers(e)})),this.messageInputElem.addListener("input",(e=>{this.handleMessageInput(e)})),this.messageFieldWrapperElem.append(e),this.userListWrapperElem.appendChildren([this.searchInput,this.activeUserList,this.inActiveUserList]),this.appendChildren([this.userListWrapperElem,this.messageFieldWrapperElem])}}G.renderEditedMessage=(e,s,t)=>{document.querySelectorAll(".message-block-js").forEach((a=>{if(a.dataset.message===e){const e=a,i=e.querySelector(".text"),n=e.querySelector(".message-edited"),o=t?"edited":"";R(i),R(n),n.textContent=o,i.textContent=s}}))},G.deleteMessage=e=>{document.querySelectorAll(".message-block-js").forEach((s=>{s.dataset.message===e&&s.remove()}))},G.readMessage=e=>{document.querySelectorAll(".message-block-js").forEach((s=>{const t=s.dataset.message,{author:a}=s.dataset;if(t===e&&"you"===a){const e=s.querySelector(".message-read");R(e),e.textContent="read"}}))},G.getUserData=()=>{const e=sessionStorage.getItem("userData");return e?JSON.parse(e):null},G.searchUsers=e=>{const s=document.querySelectorAll(".list-item"),t=e.target.value.toLowerCase();s?.forEach((e=>{const s=e,a=e.textContent?.toLowerCase(),i=a?.includes(t);s.style.display=i?"flex":"none"}))};const q=G;class ${constructor(e,s,t,a){this.isMessageFetchingByInitRender=!0,this.handleResponse=e=>{const{type:s,payload:t}=e;switch(s){case n.LOGIN:this.userLoginResponse(t);break;case n.LOGOUT:$.userLogoutResponse(t);break;case n.ACTIVE:this.getActiveUsersResponse(t);break;case n.INACTIVE:this.getInActiveUsersResponse(t);break;case n.EXTERNAL_LOGIN:this.userExternalLoginResponse();break;case n.EXTERNAL_LOGOUT:this.userExternalLogoutResponse();break;case o.SEND:this.messageSendResponse(t);break;case o.FROM:this.isMessageFetchingByInitRender?this.initFetchMessageResponse(t):this.fetchMessageResponse(t);break;case o.DELETE:$.messageDeleteResponse(t);break;case o.EDIT:$.messageEditResponse(t);break;case o.DELIVER:this.messageDeliveryResponse(t);break;case o.READ:$.messageReadResponse(t);break;case n.ERROR:$.handleError(t);break;default:console.error("Unknown payload type:",t)}},this.userLoginResponse=e=>{const{login:s}=e.user;console.log(`User ${s} logged in successfully`),window.location.hash="chat",this.model.getActiveUser(),this.model.getInActiveUser()},this.getActiveUsersResponse=e=>{this.chatView.renderActiveUsers(e.users)},this.getInActiveUsersResponse=e=>{this.chatView.renderInActiveUsers(e.users)},this.userExternalLoginResponse=()=>{this.handleExternalUserAction()},this.userExternalLogoutResponse=()=>{this.handleExternalUserAction()},this.messageSendResponse=e=>{this.chatView.renderMessage(e.message)},this.fetchMessageResponse=e=>{this.chatView.renderAllMessages(e.messages)},this.initFetchMessageResponse=e=>{this.chatView.addUnreadMessages(e.messages),this.isMessageFetchingByInitRender=!1},this.messageDeliveryResponse=e=>{const{id:s}=e.message;this.chatView.changeDeliveryStatus(s)},this.handleExternalUserAction=()=>{this.chatView.activeUserList.destroyChildren(),this.chatView.inActiveUserList.destroyChildren(),this.model.getActiveUser(),this.model.getInActiveUser()},this.model=e,this.authView=s,this.chatView=t,this.router=a}}$.userLogoutResponse=e=>{const{login:s}=e.user;console.log(`User ${s} logged out successfully`),window.location.hash="login"},$.messageDeleteResponse=e=>{const{id:s}=e.message;q.deleteMessage(s)},$.messageEditResponse=e=>{const{status:s,id:t,text:a}=e.message;R(a),R(s),q.renderEditedMessage(t,a,s.isEdited)},$.messageReadResponse=e=>{const{id:s}=e.message;q.readMessage(s)},$.handleError=e=>{const s=new d({tag:"div",classNames:["modal-error"],text:e.error}),t=new x(s);t.render(),t.addCloseBtn("Close"),t.open()};const J=$;class K{constructor(e){this.loginUser=(e,s)=>{const t={id:null,type:n.LOGIN,payload:{user:{login:e,password:s}}};this.ws.send(JSON.stringify(t))},this.logoutUser=(e,s)=>{const t={id:null,type:n.LOGOUT,payload:{user:{login:e,password:s}}};this.ws.send(JSON.stringify(t))},this.getActiveUser=()=>{const e={id:null,type:n.ACTIVE,payload:null};this.ws.send(JSON.stringify(e))},this.getInActiveUser=()=>{const e={id:null,type:n.INACTIVE,payload:null};this.ws.send(JSON.stringify(e))},this.sendMessage=(e,s)=>{const t={id:null,type:o.SEND,payload:{message:{to:e,text:s}}};this.ws.send(JSON.stringify(t))},this.fetchMessages=e=>{const s={id:null,type:o.FROM,payload:{user:{login:e}}};this.ws.send(JSON.stringify(s))},this.removeMessage=e=>{const s={id:null,type:o.DELETE,payload:{message:{id:e}}};this.ws.send(JSON.stringify(s))},this.changeMessage=(e,s)=>{const t={id:null,type:o.EDIT,payload:{message:{id:e,text:s}}};this.ws.send(JSON.stringify(t))},this.readMessage=e=>{const s={id:null,type:o.READ,payload:{message:{id:e}}};this.ws.send(JSON.stringify(s))},this.ws=e}}const X="LoginView-module_text-field_x742KT",Z="LoginView-module_label_rjuLej",Y="LoginView-module_input_vFuc2V",Q="LoginView-module_valid_VS22J5",z="LoginView-module_invalid_vUwoZg",ee="LoginView-module_hidden__AQi6V",se="LoginView-module_name-error_hU3Fht",te="LoginView-module_password-error_z_Ewun";class ae extends d{constructor(s,t,a){super({tag:"form",classNames:["LoginView-module_form_UVico1","form"]}),this.loginButton=v(["button","btn","login-btn"],"Login"),this.isNameValid=!1,this.isPasswordValid=!1,this.handleKeyDown=()=>{this.isNameValid&&this.isPasswordValid&&"#login"===window.location.hash&&(this.saveUserData(),console.log("Enter in Login pressed")),this.isNameValid=!1,this.isPasswordValid=!1},this.loginCallback=s,this.setUserDataCallback=t,this.eventManager=a,this.setAttribute(e.ACTION,""),this.addListener("submit",(e=>{e.preventDefault(),this.saveUserData(),this.isNameValid=!1,this.isPasswordValid=!1,sessionStorage.setItem("currentLocation","chat")})),this.eventManager.setLoginSubmitEventCallback(this.handleKeyDown)}setForm(){const s=p(["LoginView-module_form-title_uEPO4c","title"],"Login"),t=b([Z],"Name"),a=b([Z],"Password"),i=u([se,ee]),n=u([te,ee]);this.nameInput=w([Y,"name-input"],"name","name","text","Enter your Name","true",(e=>{this.validateName(e)})),this.passwordInput=w([Y],"password","password","password","Enter your Password","true",(e=>{this.validatePassword(e)})),t.setAttribute(e.FOR,"name"),a.setAttribute(e.FOR,"password");const o=u([X],t,this.nameInput,i),r=u([X],a,this.passwordInput,n);this.loginButton.setAttribute(e.DISABLED,"true"),this.appendChildren([s,o,r,this.loginButton])}toggleLoginButtonState(){this.isNameValid&&this.isPasswordValid?this.loginButton.removeAttribute(e.DISABLED):this.loginButton.setAttribute(e.DISABLED,"true")}toggleInputState(e,s,t){s.classList.toggle(Q,e),s.classList.toggle(z,!e),"name"===t&&(this.isNameValid=e),"password"===t&&(this.isPasswordValid=e),0===s.value.length&&(s.classList.remove(Q),s.classList.remove(z),"name"===t&&(this.isNameValid=!1),"password"===t&&(this.isPasswordValid=!1)),this.toggleLoginButtonState()}validateName(e){const s=e.target,t=ae.validateTextField(s);this.toggleInputState(t,s,s.name)}validatePassword(e){const s=e.target,t=ae.validatePasswordField(s);this.toggleInputState(t,s,s.name)}static validateTextField(e){const s=e.value,t=document.querySelector(`.${se}`);if(R(t),""===s.trim())return ae.hideErrorMessage(t),!1;if(!/^[A-Za-z-]+$/.test(s))return ae.showErrorMessage(t,'Field only accept English alphabet letters and the hyphen (" - ") symbol'),!1;if(!/^[A-Z]/.test(s))return ae.showErrorMessage(t,"First letter of the name must be in uppercase"),!1;if(s.length<3){const e="Minimum length of the name is 3 characters";return ae.showErrorMessage(t,e),!1}return ae.hideErrorMessage(t),!0}static validatePasswordField(e){const s=e.value,t=document.querySelector(`.${te}`);return R(t),""===s.trim()?(ae.hideErrorMessage(t),!1):/^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()-_+=])[A-Za-z\d!@#$%^&*()-_+=]{8,}$/.test(s)?(ae.hideErrorMessage(t),!0):(ae.showErrorMessage(t,"Password must be at least 8 characters long and contain at least one uppercase letter and one number"),!1)}static showErrorMessage(e,s){const t=e;e.classList.remove(ee),t.textContent=s}static hideErrorMessage(e){const s=e;e.classList.add(ee),s.textContent=""}saveUserData(){const e=this.nameInput?.getNode(),s=this.passwordInput?.getNode();R(e),R(s);const t={login:e.value,password:s.value},a=JSON.stringify(t);sessionStorage.setItem("userData",a),this.loginCallback(t.login,t.password),this.setUserDataCallback(t)}}class ie extends d{constructor(){super({tag:"div",classNames:["NotFound-module_not-found_RbUno8"]})}setPage(){this.getNode().innerHTML="";const e=p(["title"],"Page not found"),s=v(["btn"],"Back to the Main page");s.addListener("click",(()=>{const e=sessionStorage.getItem("userData");window.location.hash=e?"chat":"/"})),this.appendChildren([e,s])}}class ne{constructor(){this.root=u(["app"]),this.main=new S,this.userData=null,this.handleUserLogout=()=>{if(this.userData){const{login:e,password:s}=this.userData;this.model.logoutUser(e,s),sessionStorage.removeItem("userData"),this.userData=null}},this.setUserData=e=>{this.userData=e},this.updateUserList=()=>{this.model.getActiveUser(),this.model.getInActiveUser()},document.body.append(this.root.getNode()),document.body.setAttribute("data-theme","light"),this.ws=new WebSocket("ws://127.0.0.1:4000"),this.userData=ne.getUserData(),sessionStorage.setItem("currentLocation","login"),this.userData&&sessionStorage.setItem("currentLocation","chat"),this.eventManager=new F,this.model=new K(this.ws),this.header=new A(this.handleUserLogout,this.eventManager),this.loginView=new ae(this.model.loginUser,this.setUserData,this.eventManager),this.chatView=new q(this.model.sendMessage,this.model.fetchMessages,this.model.removeMessage,this.model.changeMessage,this.model.readMessage,this.eventManager),this.notFoundView=new ie,this.aboutView=new I(this.updateUserList);const e=this.createRoutes();this.router=new O(e),this.controller=new J(this.model,this.loginView,this.chatView,this.router),this.setupWebSocketEventHandlers(),this.ws.onopen=()=>{this.userData&&(this.model.loginUser(this.userData.login,this.userData.password),this.header.addHeaderBlocks(this.userData.login))},this.ws.onclose=()=>{this.handleServerDisconnect();const e=new d({tag:"p",classNames:[],text:"Connection to the server lost. Attempting to reconnect..."}),s=new x(e);s.render(),s.open(),this.root.append(s)}}createLayout(){const e=new U;this.root.appendChildren([this.header,this.main,e])}createRoutes(){return[{path:"/",render:()=>{this.main.destroyChildren(),this.loginView.setForm(),this.main.append(this.loginView)}},{path:"chat",render:()=>{this.main.destroyChildren(),this.chatView.setPage(),this.main.append(this.chatView),this.userData&&this.header.addHeaderBlocks(this.userData.login),this.ws.onopen=()=>{this.model.getActiveUser(),this.model.getInActiveUser()}}},{path:"login",render:()=>{this.main.destroyChildren(),this.loginView.setForm(),this.main.append(this.loginView)}},{path:"about",render:()=>{this.main.destroyChildren(),this.aboutView.setPage(),this.main.append(this.aboutView)}},{path:"404",render:()=>{this.main.destroyChildren(),this.notFoundView.setPage(),this.main.append(this.notFoundView)}}]}handleServerDisconnect(){setTimeout((()=>{this.ws=new WebSocket("ws://127.0.0.1:4000"),this.setupWebSocketEventHandlers()}),3e3)}setupWebSocketEventHandlers(){this.ws.onmessage=e=>{const s=JSON.parse(e.data);this.controller.handleResponse(s)},this.ws.onopen=()=>{const e=document.querySelector(".modal-js");e?.remove()},this.ws.onclose=()=>{this.handleServerDisconnect()}}}ne.getUserData=()=>{const e=sessionStorage.getItem("userData");return e?JSON.parse(e):null},(new ne).createLayout()})()})();